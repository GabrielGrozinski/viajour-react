CREATE TABLE profiles (
  id uuid primary key,
  name text not null,
  avatar_url text not null,
  email text unique not null,
  number_of_companions text not null,
  number_of_travels text not null,
  type_of_traveler text not null,
  travel_profile text not null,
  travel_cost text not null,
  travel_preferences text[] not null,
  saved_money text not null,
  saved_time text not null,
  created_at timestamptz DEFAULT now()
);

CREATE TABLE plans (
  id integer primary key,
  idInput text not null,
  name text not null,
  description text not null,
  features text[] not null,
  price integer not null,
  bgColor text not null,
  badgeColor text not null,
  titleColor text not null,
  button text not null,
  buttonHover text not null
);

INSERT INTO plans (id, name, idInput, description, features, price, bgColor, badgeColor, titleColor, button, buttonHover) VALUES
(
  1, 
  'Free',
  'free-plan',
  'A good option for those who are starting out and want to try our platform.',
  array[
    'Limited access',
    'Trip search',
    'Basic support'
  ],
  0,
  '#e3ffe9',
  '#b0f5c4',
  '#3e6b45',
  '#3fa26b',
  '#2a764a'
),
(
  2, 
  'Adventurer',
  'adventurer-plan',
  'This plan is ideal for those who travel actively or want to get the most out of them.',
  array[
    'Limited access',
    'Trip search',
    'Basic support',
    'Unlimited access',
    'No ads',
    'AI tools'
  ],
  5,
  '#ecf0ff',
  '#bed6fb',
  '#425675',
  '#6558d3',
  '#4133B7'
),
(
  3, 
  'Traveler',
  'traveler-plan',
  'Perfect for those who have a traveler''s blood!',
  array[
    'Limited access',
    'Trip search',
    'Basic support',
    'Unlimited access',
    'No ads',
    'AI tools',
    'Unlimited users',
    'Exclusive trips',
    'Early access to tools'
  ],
  10,
  '#fff3e0',
  '#ffd7a3',
  '#8a5623',
  '#e08a1e',
  '#b86d16'
);

CREATE TABLE subscription (
  id uuid primary key default gen_random_uuid(),
  user_id uuid not null,
  plan_id integer not null,
  status text not null,
  current_period_start timestamp not null,
  current_period_end timestamp not null,
  provider text not null,
  created_at timestamp default now(),

  foreign key (user_id)
    references auth.users(id)
    on delete cascade,

  foreign key (plan_id)
    references plans(id)
);
// Criando Tabela //



alter TABLE profiles enable row level security;

CREATE policy "user_info_SELECT"
on profiles
for SELECT
USING (id = auth.uid());

CREATE policy "user_info_INSERT"
on profiles
for INSERT
WITH CHECK (id = auth.uid());

CREATE policy "user_info_UPDATE"
on profiles
for UPDATE
USING (id = auth.uid());

CREATE policy "user_info_DELETE"
on profiles
for DELETE
USING (id = auth.uid());
// Alterando Tabela Usu√°rio //




alter TABLE subscription enable row level security;

CREATE policy "subscription_info_SELECT"
on subscription
for SELECT
USING (user_id = auth.uid());

CREATE policy "subscription_info_INSERT"
on subscription
for INSERT
WITH CHECK (user_id = auth.uid());

CREATE policy "subscription_info_UPDATE"
on subscription
for UPDATE
USING (user_id = auth.uid());

CREATE policy "subscription_info_DELETE"
on subscription
for DELETE
USING (user_id = auth.uid());
// Alterando Tabela Assinaturas //

CREATE POLICY "Allow read plans"
ON public.plans
FOR SELECT
USING (true);

// Viagens

create extension if not exists "pgcrypto";

  CREATE table trips (
      id uuid primary key default gen_random_uuid(),
      destination text not null,
      cost text not null,
      gross_cost integer not null,
      type text not null,
      nationality text not null,
      img text not null,
      description text not null,
      keywords text[] not null,
      created_at timestamp with time zone default now()
  );

create table favoriteTrips (
  user_id uuid not null references auth.users(id) on delete cascade,
  trip_id uuid not null references trips(id) on delete cascade,
  unique (user_id, trip_id)
);

create table calculator (
  id uuid primary key default gen_random_uuid(),
  user_id uuid not null references auth.users(id) on delete cascade,
  name text not null,
  days integer not null,
  days_cost integer[] not null,
  total_cost integer not null,
  lodging integer[] not null,
  food integer[] not null,
  transportation integer[] not null,
  leisure integer[] not null,
  created_at timestamp default now(),
  unique (user_id, id)
);